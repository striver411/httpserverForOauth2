<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>Login - DeepShare</title>

		<meta name="description" content="User login page" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="/assets/css/bootstrap.css" />
		<link rel="stylesheet" href="/assets/css/font-awesome.css" />

		<!-- text fonts -->
		<link rel="stylesheet" href="/assets/css/ace-fonts.css" />

		<!-- ace styles -->
		<link rel="stylesheet" href="/assets/css/ace.css" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="/assets/css/ace-part2.css" />
		<![endif]-->
		<link rel="stylesheet" href="/assets/css/ace-rtl.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="/assets/css/ace-ie.css" />
		<![endif]-->

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!--[if lt IE 9]>
		<script src="/assets/js/html5shiv.js"></script>
		<script src="/assets/js/respond.js"></script>
		<![endif]-->
		<style>
		.help-block {
			margin-bottom: 0px; 
		}
		</style>
	</head>

	<body class="login-layout light-login">
		<div class="main-container">
			<div class="main-content">
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<div class="login-container">
							<div class="center">
								<h1>
									<i class="ace-icon fa fa-leaf green"></i>
									<span class="red">DeepShare</span>
<!-- 									<span class="white" id="id-text2">Application</span> -->
								</h1>
								<h4 class="blue" id="id-company-text">&copy; Company Name</h4>
							</div>

							<div class="space-6"></div>

							<div class="position-relative">
								<div id="login-box" class="login-box visible widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header blue lighter bigger">
												<i class="ace-icon fa fa-coffee green"></i>
												登录
											</h4>

											<div class="space-6"></div>

											<form id="login-form" method="post">
												<fieldset>
													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input name="username" id="username" type="text" class="form-control" placeholder="用户名" />
															<i class="ace-icon fa fa-user"></i>
														</span>
													</label>
													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input name="password" id="password" type="password" class="form-control" placeholder="密码"/>
															<i class="ace-icon fa fa-lock"></i>
														</span>
														<div id="info" style="color: #d16e6c;display: none" class="help-block"></div>
													</label>
													<!-- <div><?php echo isset($_GET['code'])?$_GET['code']:'' ?></div> -->
													<div class="space"></div>

													<div class="clearfix">
														<label class="inline">
															<input checked="checked" name="rememberMe" class="ace ace-checkbox-2" id="rememberMe" value="1" type="checkbox" />
															<span class="lbl"> 记住登录</span>
														</label>

														<button type="submit" class="width-35 pull-right btn btn-sm btn-primary" >
															<i class="ace-icon fa fa-key"></i>
															<span class="bigger-110">登录</span>
														</button>
													</div>

													<div class="space-4"></div>
												</fieldset>
											</form>

											<div class="social-or-login center">
												<span class="bigger-110">或用以下方式登录</span>
											</div>

											<div class="space-6"></div>

											<div class="social-login center">
												<a class="btn btn-info" title="Github登录" href={{.GithubAuthURL}}>
													<i class="ace-icon fa fa-github"></i>
												</a>
											</div>
										</div><!-- /.widget-main -->

										<!-- <div class="toolbar clearfix">
											<div>
												<a href="#" data-target="#forgot-box" class="forgot-password-link">
													<i class="ace-icon fa fa-arrow-left"></i>
													忘记密码？
												</a>
											</div>

											<div>
												<a href="#" data-target="#signup-box" class="user-signup-link">
													新用户注册
													<i class="ace-icon fa fa-arrow-right"></i>
												</a>
											</div>
										</div> -->
									</div><!-- /.widget-body -->
								</div><!-- /.login-box -->

								<div id="forgot-box" class="forgot-box widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header red lighter bigger">
												<i class="ace-icon fa fa-key"></i>
												找回密码
											</h4>

											<div class="space-6"></div>
<!-- 											<p> -->
<!-- 												Enter your email and to receive instructions -->
<!-- 											</p> -->

											<form id="forgot-form"  method="post">
												<fieldset>
													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input id="email_retrieve" name="email_retrieve" type="email" class="form-control" placeholder="邮箱"/>
															<i class="ace-icon fa fa-envelope"></i>
														</span>
													</label>
													<div id="info_retrieve" style="color: red;"></div>
													<div class="clearfix">
														<button type="submit" class="width-35 pull-right btn btn-sm btn-danger">
															<i class="ace-icon fa fa-lightbulb-o"></i>
															<span class="bigger-110">发送邮件</span>
														</button>
													</div>
												</fieldset>
											</form>
										</div><!-- /.widget-main -->

										<div class="toolbar center">
											<a href="#" data-target="#login-box" class="back-to-login-link">
												返回登录
												<i class="ace-icon fa fa-arrow-right"></i>
											</a>
										</div>
									</div><!-- /.widget-body -->
								</div><!-- /.forgot-box -->

								<div id="signup-box" class="signup-box widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header green lighter bigger">
												<i class="ace-icon fa fa-users blue"></i>
												新用户注册
											</h4>

											<div class="space-6"></div>
<!-- 											<p> Enter your details to begin: </p> -->

											<form id="user-signup-form" method="post">
												<fieldset>
													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input type="email" class="form-control" placeholder="邮箱" name="s_email" id="s_email" />
															<i class="ace-icon fa fa-envelope"></i>
														</span>
													</label>

													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" placeholder="用户名" name="s_username" id="s_username" />
															<i class="ace-icon fa fa-user"></i>
														</span>
													</label>
													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" placeholder="手机号" name="s_nbr" id="s_nbr" />
															<i class="ace-icon fa fa-mobile"></i>
														</span>
													</label>
													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" placeholder="密码" name="s_password" id="s_password" />
															<i class="ace-icon fa fa-lock"></i>
														</span>
													</label>

													<label class="block clearfix form-group">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" placeholder="重复密码" name="s_password2" id="s_password2"/>
															<i class="ace-icon fa fa-retweet"></i>
														</span>
													</label>

													<div class="form-group" style="font-size: 14px">
													<label class="block">
														<input checked="checked" type="checkbox" class="ace ace-checkbox-2" id="s_agreement" name="s_agreement"/>
														<span class="lbl">
															我已阅读<a href="#">服务条款</a>
														</span>
													</label>
													</div>

													<div class="space-24"></div>

													<div class="clearfix">
														<button type="reset" class="width-30 pull-left btn btn-sm">
															<i class="ace-icon fa fa-refresh"></i>
															<span class="bigger-110">重置</span>
														</button>

														<button type="submit" class="width-65 pull-right btn btn-sm btn-success">
															<span class="bigger-110">注册</span>

															<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
														</button>
													</div>
												</fieldset>
											</form>
										</div>

										<div class="toolbar center">
											<a href="#" data-target="#login-box" class="back-to-login-link">
												<i class="ace-icon fa fa-arrow-left"></i>
												返回登录
											</a>
										</div>
									</div><!-- /.widget-body -->
								</div><!-- /.signup-box -->
							</div><!-- /.position-relative -->

						</div>
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.main-content -->
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script type="text/javascript">
			window.jQuery || document.write("<script src='/assets/js/jquery.js'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='/assets/js/jquery1x.js'>"+"<"+"/script>");
</script>
<![endif]-->
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='/assets/js/jquery.mobile.custom.js'>"+"<"+"/script>");
		</script>

		<!-- inline scripts related to this page -->
		<script src="/assets/js/easyform.js"></script>
		<script src="/assets/js/jquery.validate.js"></script>
		<script src="/assets/js/jquery.maskedinput.js"></script>
		<script type="text/javascript">
			jQuery(function($) {
			 $(document).on('click', '.toolbar a[data-target]', function(e) {
				e.preventDefault();
				var target = $(this).data('target');
				$('.widget-box.visible').removeClass('visible');//hide others
				$(target).addClass('visible');//show target
			 });
			});

			$(document).ready(function(){
				$("a[data-target]").click(function(){
					$("div[id^='easytip-div']").fadeOut();
				});
				$("#username").focus(function(){
					$("#info").hide();
				});
				$("#password").focus(function(){
					$("#info").hide();
				});

				$.mask.definitions['~']='[+-]';
				$('#nbr').mask('99999999999');
			
				jQuery.validator.addMethod("phone", function (value, element) {
					return this.optional(element) || /^\d{11}$/.test(value);
				}, "请输入有效的手机号码");
				
				$('#user-signup-form').validate({
					errorElement: 'div',
					errorClass: 'help-block',
					focusInvalid: false,
					ignore: "",
					rules: {
						s_email:{
							required: true,
							email:true,
							remote:{
					               type:"POST",
					               url:"/check",
					               data:{
					                 data:function(){return $("#s_email").val();},
					                 type:"email"
					               } 
				            } 
						},
						s_username:{
							required: true,
							rangelength:[6,20],
							remote:{
					               type:"POST",
					               url:"/check",
					               data:{
					                 data:function(){return $("#s_username").val();},
					                 type:"username"
					               } 
				            } 
						},
						s_nbr:{
							required: true,
							phone: 'required'
						},
						s_password:{
							required: true,
							rangelength:[6,20]
						},
						s_password2:{
							required: true,
							equalTo:"#s_password"
						},
						s_agreement:{
							required: true
						}
					},
			
					messages: {
						s_email: {
							required: "请输入邮箱地址",
							email: "请输入有效的邮箱地址",
							remote: "该邮箱已被注册"
						},
						s_username: {
							required: "请输入用户名",
							rangelength:"用户名长度在6-20之间",
							remote: "该用户名已注册"
						},
						s_nbr:{
							required: "请输入手机号",
							phone: '请输入有效的手机号'
						},
						s_password: {
							required: "请输入密码",
							rangelength:"密码长度在6-20之间"
						},
						s_password2:{
							required: "请再次输入密码",
							equalTo:"两次密码输入不一致"
						},
						s_agreement:"请阅读并同意我们的服务条款"
						
					},
			
			
					highlight: function (e) {
						$(e).closest('.form-group').removeClass('has-info').addClass('has-error');
					},
			
					success: function (e) {
						$(e).closest('.form-group').removeClass('has-error');//.addClass('has-info');
						$(e).remove();
					},
			
					errorPlacement: function (error, element) {
						error.insertAfter(element.parent());
					},
			
					submitHandler: function (form) {
						 $.ajax({
			                    type: "POST",
			                    dataType: "html",
			                    url: "/signup",
			                    data: $('#user-signup-form').serialize(),
			                    success: function (result) {
			                        if(result=="true") {
			                        	location.href='/index';
				                    } else {
// 										alert("1111！");
						            }
			                    },
			                    error: function(data) {
// 			                        alert("error:"+data.responseText);
			                    }
			               });
					},
					invalidHandler: function (form) {
					}
				});

				$('#forgot-form').validate({
					errorElement: 'div',
					errorClass: 'help-block',
					focusInvalid: false,
					ignore: "",
					rules: {
						email_retrieve:{
							required: true,
							email:true
						}
					},
			
					messages: {
						email_retrieve: {
							required: "请输入邮箱地址",
							email: "请输入有效的邮箱地址"
						}
					},
			
			
					highlight: function (e) {
						$(e).closest('.form-group').removeClass('has-info').addClass('has-error');
					},
			
					success: function (e) {
						$(e).closest('.form-group').removeClass('has-error');//.addClass('has-info');
						$(e).remove();
					},
			
					errorPlacement: function (error, element) {
						error.insertAfter(element.parent());
					},
			
					submitHandler: function (form) {
						//TODO:发送email，前台倒数60s，后台发送
					},
					invalidHandler: function (form) {
					}
				});

				$('#login-form').validate({
					errorElement: 'div',
					errorClass: 'help-block',
					focusInvalid: false,
					ignore: "",
					rules: {
						username:{
							required: true
						},
						password: {
							required: true
						}
					},
			
					messages: {
						username: "请输入用户名",
						password: "请输入密码"
					},
			
			
					highlight: function (e) {
						$(e).closest('.form-group').removeClass('has-info').addClass('has-error');
					},
			
					success: function (e) {
						$(e).closest('.form-group').removeClass('has-error');//.addClass('has-info');
						$(e).remove();
					},
			
					errorPlacement: function (error, element) {
						if(element.is('input[type=checkbox]') || element.is('input[type=radio]')) {
							var controls = element.closest('div[class*="col-"]');
							if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
							else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
						}else error.insertAfter(element.parent());
					},
			
					submitHandler: function (form) {
						 $.ajax({
			                    type: "POST",
			                    dataType: "html",
			                    url: "/post/checkauth",
			                    data: $('#login-form').serialize(),
			                    success: function (result) {
			                        if(result=="true") {
			                        	location.href='/index';
				                    } else {
										$("#info").show().html("用户名或密码错误");
						            }
			                    },
			                    error: function(data) {
// 			                        alert("error:"+data.responseText);
			                    }
			               });
					},
					invalidHandler: function (form) {
					}
				});
			});

			function check(type){
				var value = "true";
				var lowerType=type.toLocaleLowerCase();
				var aj = $.ajax( {    
				    url:'/check',
				    data:{    
				    	"data":$("#User_"+lowerType).val(),
				    	"type":lowerType
				    },    
				    type:'post', 
				    async:false,   
				    success:function(data) {    
				        value=data;
				    }
				});
				return value=="true"?true:false;
			}
		</script>
	</body>
</html>
